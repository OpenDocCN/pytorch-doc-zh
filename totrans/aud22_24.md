# 音频数据增强

> 原文：[https://pytorch.org/audio/stable/tutorials/audio_data_augmentation_tutorial.html](https://pytorch.org/audio/stable/tutorials/audio_data_augmentation_tutorial.html)

注意

点击[这里](#sphx-glr-download-tutorials-audio-data-augmentation-tutorial-py)下载完整示例代码

**作者**: [Moto Hira](mailto:moto%40meta.com)

`torchaudio` 提供了多种增强音频数据的方法。

在本教程中，我们将探讨一种应用效果、滤波器、RIR（房间冲激响应）和编解码器的方法。

最后，我们从干净的语音中合成带噪声的电话语音。

```py
import torch
import torchaudio
import torchaudio.functional as F

print(torch.__version__)
print([torchaudio.__version__](https://docs.python.org/3/library/stdtypes.html#str "builtins.str"))

import matplotlib.pyplot as plt 
```

```py
2.2.0
2.2.0 
```

## 准备工作[](#preparation "跳转到此标题的永久链接")

首先，我们导入模块并下载本教程中使用的音频资产。

```py
from IPython.display import Audio

from torchaudio.utils import download_asset

[SAMPLE_WAV](https://docs.python.org/3/library/stdtypes.html#str "builtins.str") = download_asset("tutorial-assets/steam-train-whistle-daniel_simon.wav")
[SAMPLE_RIR](https://docs.python.org/3/library/stdtypes.html#str "builtins.str") = download_asset("tutorial-assets/Lab41-SRI-VOiCES-rm1-impulse-mc01-stu-clo-8000hz.wav")
[SAMPLE_SPEECH](https://docs.python.org/3/library/stdtypes.html#str "builtins.str") = download_asset("tutorial-assets/Lab41-SRI-VOiCES-src-sp0307-ch127535-sg0042-8000hz.wav")
[SAMPLE_NOISE](https://docs.python.org/3/library/stdtypes.html#str "builtins.str") = download_asset("tutorial-assets/Lab41-SRI-VOiCES-rm1-babb-mc01-stu-clo-8000hz.wav") 
```

```py
 0%|          | 0.00/427k [00:00<?, ?B/s]
100%|##########| 427k/427k [00:00<00:00, 122MB/s]

  0%|          | 0.00/31.3k [00:00<?, ?B/s]
100%|##########| 31.3k/31.3k [00:00<00:00, 63.3MB/s]

  0%|          | 0.00/78.2k [00:00<?, ?B/s]
100%|##########| 78.2k/78.2k [00:00<00:00, 78.5MB/s] 
```

## 应用效果和滤波[](#applying-effects-and-filtering "跳转到此标题的永久链接")

[`torchaudio.io.AudioEffector`](../generated/torchaudio.io.AudioEffector.html#torchaudio.io.AudioEffector "torchaudio.io.AudioEffector") 允许直接将滤波器和编解码器应用于张量对象，类似于 `ffmpeg` 命令

AudioEffector 用法 <./effector_tutorial.html> 解释了如何使用这个类，因此详细信息请参考教程。

```py
# Load the data
[waveform1](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int") = torchaudio.load([SAMPLE_WAV](https://docs.python.org/3/library/stdtypes.html#str "builtins.str"), channels_first=False)

# Define effects
[effect](https://docs.python.org/3/library/stdtypes.html#str "builtins.str") = ",".join(
    [
        "lowpass=frequency=300:poles=1",  # apply single-pole lowpass filter
        "atempo=0.8",  # reduce the speed
        "aecho=in_gain=0.8:out_gain=0.9:delays=200:decays=0.3|delays=400:decays=0.3"
        # Applying echo gives some dramatic feeling
    ],
)

# Apply effects
def apply_effect([waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), [effect](https://docs.python.org/3/library/stdtypes.html#str "builtins.str")):
    effector = torchaudio.io.AudioEffector([effect](https://docs.python.org/3/library/stdtypes.html#str "builtins.str")=[effect](https://docs.python.org/3/library/stdtypes.html#str "builtins.str"))
    return effector.apply([waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"))

[waveform2](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = apply_effect([waveform1](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), [effect](https://docs.python.org/3/library/stdtypes.html#str "builtins.str"))

print([waveform1](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor").shape, [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"))
print([waveform2](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor").shape, [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

```py
torch.Size([109368, 2]) 44100
torch.Size([144642, 2]) 44100 
```

请注意，应用效果后，帧数和通道数与原始数据不同。让我们听一下音频。

```py
def plot_waveform([waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Waveform", xlim=None):
    [waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = [waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor").numpy()

    num_channels, num_frames = [waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor").shape
    time_axis = [torch.arange](https://pytorch.org/docs/stable/generated/torch.arange.html#torch.arange "torch.arange")(0, num_frames) / [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")

    figure, axes = plt.subplots(num_channels, 1)
    if num_channels == 1:
        axes = [axes]
    for c in range(num_channels):
        axes[c].plot(time_axis, [waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")[c], linewidth=1)
        axes[c].grid(True)
        if num_channels > 1:
            axes[c].set_ylabel(f"Channel {c+1}")
        if xlim:
            axes[c].set_xlim(xlim)
    figure.suptitle(title) 
```

```py
def plot_specgram([waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Spectrogram", xlim=None):
    [waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = [waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor").numpy()

    num_channels, [_](https://docs.python.org/3/library/functions.html#int "builtins.int") = [waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor").shape

    figure, axes = plt.subplots(num_channels, 1)
    if num_channels == 1:
        axes = [axes]
    for c in range(num_channels):
        axes[c].specgram([waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")[c], Fs=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"))
        if num_channels > 1:
            axes[c].set_ylabel(f"Channel {c+1}")
        if xlim:
            axes[c].set_xlim(xlim)
    figure.suptitle(title) 
```

### 原始[](#original "跳转到此标题的永久链接")

```py
plot_waveform([waveform1.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Original", xlim=(-0.1, 3.2))
plot_specgram([waveform1.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Original", xlim=(0, 3.04))
Audio([waveform1.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

+   ![原始](../Images/fd3a3a2790a98d9fbdf35ffecf8587e9.png)

+   ![原始](../Images/f52e4934ba626b863f8e8a2d4790f2c6.png)

您的浏览器不支持音频元素。

### 应用的效果[](#effects-applied "跳转到此标题的永久链接")

```py
plot_waveform([waveform2.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Effects Applied", xlim=(-0.1, 3.2))
plot_specgram([waveform2.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Effects Applied", xlim=(0, 3.04))
Audio([waveform2.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

+   ![应用了效果](../Images/a82e5c6d55bae10c1c9e2581fc308d54.png)

+   ![应用了效果](../Images/5e9bb14130f4a614142bdb66ad8e731f.png)

您的浏览器不支持音频元素。

## 模拟房间混响[](#simulating-room-reverberation "跳转到此标题的永久链接")

[卷积混响](https://en.wikipedia.org/wiki/Convolution_reverb) 是一种技术，用于使干净的音频听起来好像是在不同的环境中产生的。

例如，使用房间冲激响应（RIR），我们可以使干净的语音听起来好像是在会议室中发出的。

对于这个过程，我们需要 RIR 数据。以下数据来自 VOiCES 数据集，但您也可以录制自己的数据 — 只需打开麦克风并拍手。

```py
[rir_raw](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int") = torchaudio.load([SAMPLE_RIR](https://docs.python.org/3/library/stdtypes.html#str "builtins.str"))
plot_waveform([rir_raw](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Room Impulse Response (raw)")
plot_specgram([rir_raw](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Room Impulse Response (raw)")
Audio([rir_raw](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

+   ![房间冲激响应（原始）](../Images/f73a484c4bc6e6778cfb4ad26a629b7a.png)

+   ![房间冲激响应（原始）](../Images/c37679ae712317905097e6ad96d57ed1.png)

您的浏览器不支持音频元素。

首先，我们需要清理 RIR。我们提取主要脉冲并通过其功率进行归一化。

```py
[rir](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = [rir_raw](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")[:, int([sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int") * 1.01) : int([sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int") * 1.3)]
[rir](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = [rir](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") / [torch.linalg.vector_norm](https://pytorch.org/docs/stable/generated/torch.linalg.vector_norm.html#torch.linalg.vector_norm "torch.linalg.vector_norm")([rir](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), ord=2)

plot_waveform([rir](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Room Impulse Response") 
```

![房间冲激响应](../Images/788c83e33cb0b55e5f21cf93bca8808f.png)

然后，使用 [`torchaudio.functional.fftconvolve()`](../generated/torchaudio.functional.fftconvolve.html#torchaudio.functional.fftconvolve "torchaudio.functional.fftconvolve")，我们将语音信号与 RIR 进行卷积。

```py
[speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [_](https://docs.python.org/3/library/functions.html#int "builtins.int") = torchaudio.load([SAMPLE_SPEECH](https://docs.python.org/3/library/stdtypes.html#str "builtins.str"))
[augmented](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = F.fftconvolve([speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [rir](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")) 
```

### 原始[](#id1 "跳转到此标题的永久链接")

```py
plot_waveform([speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Original")
plot_specgram([speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Original")
Audio([speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

+   ![原始](../Images/0f2a5c0e0bfb1d0890035e4da34d5498.png)

+   ![原始](../Images/4b10804a900de5f0e8495b94b28ed9a3.png)

您的浏览器不支持音频元素。

### 应用了 RIR[](#rir-applied "跳转到此标题的永久链接")

```py
plot_waveform([augmented](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="RIR Applied")
plot_specgram([augmented](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="RIR Applied")
Audio([augmented](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

+   ![应用了 RIR](../Images/0e27d20e2c9282fff85ef0e288df2461.png)

+   ![应用了RIR](../Images/e378af1235090badb424a929fa3699d3.png)

您的浏览器不支持音频元素。

## 添加背景噪声[](#adding-background-noise "跳转到此标题的永久链接")

为了向音频数据引入背景噪声，我们可以根据一定的信噪比（SNR）[[维基百科](https://en.wikipedia.org/wiki/Signal-to-noise_ratio)]，将噪声张量添加到表示音频数据的张量中，该信噪比确定了输出中音频数据相对于噪声的强度。

$$ \mathrm{SNR} = \frac{P_{signal}}{P_{noise}} $$

$$ \mathrm{SNR_{dB}} = 10 \log _{{10}} \mathrm {SNR} $$

要根据 SNR 添加噪声到音频数据，我们使用 [`torchaudio.functional.add_noise()`](../generated/torchaudio.functional.add_noise.html#torchaudio.functional.add_noise "torchaudio.functional.add_noise")。

```py
[speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [_](https://docs.python.org/3/library/functions.html#int "builtins.int") = torchaudio.load([SAMPLE_SPEECH](https://docs.python.org/3/library/stdtypes.html#str "builtins.str"))
[noise](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [_](https://docs.python.org/3/library/functions.html#int "builtins.int") = torchaudio.load([SAMPLE_NOISE](https://docs.python.org/3/library/stdtypes.html#str "builtins.str"))
[noise](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = [noise](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")[:, : [speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor").shape[1]]

[snr_dbs](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = [torch.tensor](https://pytorch.org/docs/stable/generated/torch.tensor.html#torch.tensor "torch.tensor")([20, 10, 3])
[noisy_speeches](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = F.add_noise([speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [noise](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [snr_dbs](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")) 
```

### 背景噪音[](#background-noise "Permalink to this heading")

```py
plot_waveform([noise](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Background noise")
plot_specgram([noise](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Background noise")
Audio([noise](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

+   ![背景噪音](../Images/2195bd8e66f6a6580ee504b1adb91363.png)

+   ![背景噪音](../Images/0d5bd7d1f937b6ae3f831e3e52acfd63.png)

您的浏览器不支持音频元素。

### SNR 20 dB[](#snr-20-db "Permalink to this heading")

```py
[snr_db](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [noisy_speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = [snr_dbs](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")[0], [noisy_speeches](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")[0:1]
plot_waveform([noisy_speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title=f"SNR: {[snr_db](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")} [dB]")
plot_specgram([noisy_speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title=f"SNR: {[snr_db](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")} [dB]")
Audio([noisy_speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

+   ![SNR: 20 [dB]](../Images/f7a8cf1735194651621a1350821f57dd.png)

+   ![SNR: 20 [dB]](../Images/cdb0c54dbc451ae3a5fcdbf39808ecc1.png)

您的浏览器不支持音频元素。

### SNR 10 dB[](#snr-10-db "Permalink to this heading")

```py
[snr_db](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [noisy_speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = [snr_dbs](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")[1], [noisy_speeches](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")[1:2]
plot_waveform([noisy_speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title=f"SNR: {[snr_db](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")} [dB]")
plot_specgram([noisy_speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title=f"SNR: {[snr_db](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")} [dB]")
Audio([noisy_speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

+   ![SNR: 10 [dB]](../Images/8fd46e30c011a829fcb048b98e4f1ab6.png)

+   ![SNR: 10 [dB]](../Images/17d02f8b37a65e6ba53bbba437582a37.png)

您的浏览器不支持音频元素。

### SNR 3 dB[](#snr-3-db "Permalink to this heading")

```py
[snr_db](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [noisy_speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = [snr_dbs](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")[2], [noisy_speeches](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")[2:3]
plot_waveform([noisy_speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title=f"SNR: {[snr_db](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")} [dB]")
plot_specgram([noisy_speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title=f"SNR: {[snr_db](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")} [dB]")
Audio([noisy_speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

+   ![SNR: 3 [dB]](../Images/37e0900a5daa43f41c546c972044c4a0.png)

+   ![SNR: 3 [dB]](../Images/f50ed2b87b84504cbdb4d465036f9918.png)

您的浏览器不支持音频元素。

## 将编解码器应用于 Tensor 对象[](#applying-codec-to-tensor-object "Permalink to this heading")

[`torchaudio.io.AudioEffector`](../generated/torchaudio.io.AudioEffector.html#torchaudio.io.AudioEffector "torchaudio.io.AudioEffector") 也可以将编解码器应用于 Tensor 对象。

```py
[waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int") = torchaudio.load([SAMPLE_SPEECH](https://docs.python.org/3/library/stdtypes.html#str "builtins.str"), channels_first=False)

def apply_codec([waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), format, encoder=None):
    encoder = torchaudio.io.AudioEffector(format=format, encoder=encoder)
    return encoder.apply([waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

### 原始[](#id2 "Permalink to this heading")

```py
plot_waveform([waveform.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Original")
plot_specgram([waveform.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Original")
Audio([waveform.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

+   ![原始](../Images/7e4df06a19a9b0b5cb5dbb489245e170.png)

+   ![原始](../Images/f1649f72c67453bb1a4f5aa7df74834d.png)

您的浏览器不支持音频元素。

### 8 位 mu-law[](#bit-mu-law "Permalink to this heading")

```py
[mulaw](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = apply_codec([waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), "wav", encoder="pcm_mulaw")
plot_waveform([mulaw.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="8 bit mu-law")
plot_specgram([mulaw.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="8 bit mu-law")
Audio([mulaw.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

+   ![8 bit mu-law](../Images/da7d3b00ec3c94bda66e5ed9dcecc4ef.png)

+   ![8 bit mu-law](../Images/233500bee78b4550f44ff61a1e4265d0.png)

您的浏览器不支持音频元素。

### G.722[](#g-722 "Permalink to this heading")

```py
[g722](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = apply_codec([waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), "g722")
plot_waveform([g722.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="G.722")
plot_specgram([g722.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="G.722")
Audio([g722.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

+   ![G.722](../Images/97bb1fc2f122f9baab51c4d4178c0369.png)

+   ![G.722](../Images/79494d74bcb76479497243b7b87b4a1e.png)

您的浏览器不支持音频元素。

### Vorbis[](#vorbis "Permalink to this heading")

```py
[vorbis](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = apply_codec([waveform](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), "ogg", encoder="vorbis")
plot_waveform([vorbis.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Vorbis")
plot_specgram([vorbis.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Vorbis")
Audio([vorbis.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

+   ![Vorbis](../Images/3d2870afbcb3f87befd96c079f07422b.png)

+   ![Vorbis](../Images/e4d754f05dbc5041ae2702eef0a6e5fc.png)

您的浏览器不支持音频元素。

## 模拟电话录音[](#simulating-a-phone-recoding "Permalink to this heading")

结合前面的技术，我们可以模拟听起来像一个人在带有回声的房间里通过电话交谈，背景有人在说话的音频。

```py
[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int") = 16000
[original_speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int") = torchaudio.load([SAMPLE_SPEECH](https://docs.python.org/3/library/stdtypes.html#str "builtins.str"))

plot_specgram([original_speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Original")

# Apply RIR
[rir_applied](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = F.fftconvolve([speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [rir](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"))

plot_specgram([rir_applied](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="RIR Applied")

# Add background noise
# Because the noise is recorded in the actual environment, we consider that
# the noise contains the acoustic feature of the environment. Therefore, we add
# the noise after RIR application.
[noise](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [_](https://docs.python.org/3/library/functions.html#int "builtins.int") = torchaudio.load([SAMPLE_NOISE](https://docs.python.org/3/library/stdtypes.html#str "builtins.str"))
[noise](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = [noise](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor")[:, : [rir_applied](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor").shape[1]]

[snr_db](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = [torch.tensor](https://pytorch.org/docs/stable/generated/torch.tensor.html#torch.tensor "torch.tensor")([8])
[bg_added](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = F.add_noise([rir_applied](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [noise](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [snr_db](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"))

plot_specgram([bg_added](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="BG noise added")

# Apply filtering and change sample rate
[effect](https://docs.python.org/3/library/stdtypes.html#str "builtins.str") = ",".join(
    [
        "lowpass=frequency=4000:poles=1",
        "compand=attacks=0.02:decays=0.05:points=-60/-60|-30/-10|-20/-8|-5/-8|-2/-8:gain=-8:volume=-7:delay=0.05",
    ]
)

[filtered](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = apply_effect([bg_added.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int"), [effect](https://docs.python.org/3/library/stdtypes.html#str "builtins.str"))
[sample_rate2](https://docs.python.org/3/library/functions.html#int "builtins.int") = 8000

plot_specgram([filtered.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate2](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="Filtered")

# Apply telephony codec
[codec_applied](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor") = apply_codec([filtered](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate2](https://docs.python.org/3/library/functions.html#int "builtins.int"), "g722")
plot_specgram([codec_applied.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), [sample_rate2](https://docs.python.org/3/library/functions.html#int "builtins.int"), title="G.722 Codec Applied") 
```

+   ![原始](../Images/5691335d0652824bed1251f32ebb4df8.png)

+   ![RIR 应用](../Images/2d426224493946d97ab5a594c6ffac62.png)

+   ![添加了背景噪音](../Images/7814889105a2285420d8412a167108c0.png)

+   ![Filtered](../Images/95fad1dd9f3d229a7e22a16e829686f3.png)

+   ![G.722 编解码器应用](../Images/b087cc2781e5c09b6c5e4e2d541fd64b.png)

### 原始语音[](#original-speech "Permalink to this heading")

```py
Audio([original_speech](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

您的浏览器不支持音频元素。

### 已应用 RIR[](#id3 "Permalink to this heading")

```py
Audio([rir_applied](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

您的浏览器不支持音频元素。

### 添加了背景噪音[](#background-noise-added "Permalink to this heading")

```py
Audio([bg_added](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

您的浏览器不支持音频元素。

### Filtered[](#filtered "Permalink to this heading")

```py
Audio([filtered.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate2](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

您的浏览器不支持音频元素。

### 已应用编解码器[](#codec-applied "Permalink to this heading")

```py
Audio([codec_applied.T](https://pytorch.org/docs/stable/tensors.html#torch.Tensor "torch.Tensor"), rate=[sample_rate2](https://docs.python.org/3/library/functions.html#int "builtins.int")) 
```

您的浏览器不支持音频元素。

**脚本的总运行时间：**（0 分钟 13.432 秒）

[`下载 Python 源代码：audio_data_augmentation_tutorial.py`](../_downloads/5035f46f2e1c1557dfa0ffabb90a0b0a/audio_data_augmentation_tutorial.py)

[`下载 Jupyter 笔记本：audio_data_augmentation_tutorial.ipynb`](../_downloads/08314ca72c2aad9b7951279f0a24a983/audio_data_augmentation_tutorial.ipynb)

[Sphinx-Gallery 生成的画廊](https://sphinx-gallery.github.io)
